{% extends 'base.html' %}

{% block content %}

<script>
    console.log("JavaScript ist geladen!");
    document.addEventListener("DOMContentLoaded", function () {
        function setupFormset(containerId, addButtonId, prefix) {
            let container = document.getElementById(containerId);
            let addButton = document.getElementById(addButtonId);
            let totalForms = document.getElementById(`id_${prefix}-TOTAL_FORMS`);

            addButton.addEventListener("click", function () {
                console.log("button clicked!");
                let formNum = Number(totalForms.value);
                // let newForm = container.children[1].cloneNode(true);  // Erstes vorhandenes Formular klonen
                let newForm = container.lastElementChild.cloneNode(true);

                if (!newForm) {
                    console.error("Fehler: Kein Formular gefunden!");
                    return;
                }

                console.log("Vorher: ", totalForms.value);
                
                newForm.querySelectorAll("input, select, textarea").forEach(function (input) {
                    let name = input.name.replace(/-\d+-/, `-${formNum}-`);
                    let id = input.id.replace(/-\d+-/, `-${formNum}-`);
                    input.name = name;
                    input.id = id;
                    input.value = "";  // Felder leeren
                });

                newForm.style.display = "block";
                container.appendChild(newForm);
                totalForms.value = formNum + 1;  // Anzahl der Formulare aktualisieren

                console.log("Nachher: ", totalForms.value);
            });
        }

        // Für Teilnehmer
        setupFormset("teilnehmer-container", "add-teilnehmer", "{{ teilnehmer_formset.prefix }}");

        // Für Materialien
        setupFormset("materialien-container", "add-material", "{{ material_formset.prefix }}");
    });
</script>

<div class="container">
    <h2>{% if workshop %}Workshop bearbeiten{% else %}Neuen Workshop erstellen{% endif %}</h2>

    <form method="post" class="mt-4">
        {% csrf_token %}
        <div class="mb-3">
            {{ form.as_p }}
        </div>


        <h3>Teilnehmner</h3>
        <div id="teilnehmer-container">
            {{ teilnehmer_formset.management_form }}

            {% for form in teilnehmer_formset %}
                <div class="teilnehmer-formset">
                    {{ form.as_table }}
                </div>
            {% endfor %}
        </div>
        <button type="button" id="add-teilnehmer" class="btn btn-info">+ Teilnehmer hinzufügen</button>


        <h3>Materialien</h3>
        <div id="materialien-container">
            {{ material_formset.management_form }}

            {% for form in material_formset %}
                <div class="material-form">
                    {{ form.as_p }}
                </div>
            {% endfor %}
        </div>
        <button type="button" id="add-material" class="btn btn-info">+ Material hinzufügen</button>

        <br>
        <button type="submit" class="btn btn-primary">Speichern</button>
        <a href="{% url 'workshop_liste' %}" class="btn btn-secondary">Zurück</a>
    </form>
</div>






<!-- <script>
    document.addEventListener("DOMContentLoaded", function () {
        let container = document.getElementById("teilnehmer-container");
        let addButton = document.getElementById("add-teilnehmer");
        let totalForms = document.getElementById("id_{{ teilnehmer_formset.prefix }}-TOTAL_FORMS");
    
        addButton.addEventListener("click", function () {
            let formNum = Number(totalForms.value);
            let newForm = container.children[1].cloneNode(true);  // Erstes vorhandenes Formular klonen
    
            newForm.querySelectorAll("input, select, textarea").forEach(function (input) {
                let name = input.name.replace(/-\d+-/, `-${formNum}-`);
                let id = input.id.replace(/-\d+-/, `-${formNum}-`);
                input.name = name;
                input.id = id;
                input.value = "";  // Felder leeren
            });
    
            newForm.style.display = "block";
            container.appendChild(newForm);
            totalForms.value = formNum + 1;  // Anzahl der Formulare aktualisieren
        });
    });
    </script> -->


{% endblock %}
